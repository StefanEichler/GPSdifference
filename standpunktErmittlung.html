<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Positionsabweichungsrechner</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		td {
			text-align: center;
			vertical-align: top;
		}

	</style>
</head>

<body>
	<table>
		<tr>
			<th>Name</th>
			<th>Shall</th>
			<th>Is</th>
			<th>Diffrence</th>
		</tr>
		<tr>
			<td>East</td>
			<td><label id="east"></label></td>
			<td><label id="eastIst"></label></td>
			<td><label id="eastDiff"></label></td>
		</tr>
		<tr>
			<td>North</td>
			<td><label id="north"></label></td>
			<td><label id="northIst"></label></td>
			<td><label id="northDiff"></label></td>
		</tr>
		<tr>
			<td>Height</td>
			<td><label id="height"></label></td>
			<td><label id="heightIst"></label></td>
			<td><label id="heightDiff"></label></td>
		</tr>
		<tr>
			<td colspan="4">
				<hr>
			</td>
		</tr>
		<tr>
			<td>Angle</td>
			<td><label id="angle"></label></td>
		</tr>
		<tr>
			<td>Distance</td>
			<td><label id="distance"></label></td>
		</tr>
		<tr>
			<td colspan="4">
				<hr>
			</td>
		</tr>
		<tr>
			<th>Accuracy</th>
		</tr>
		<tr>
			<td>East-North</td>
			<td><label id="accuracy"></label></td>
		</tr>
		<tr>
			<td>Height</td>
			<td><label id="accuracyHeight"></label></td>
		</tr>
	</table>

	<p id="error" style="color:red;"></p>

	<input type="checkbox" id="fullFloat" name="fullFloat" value="true">Show up to 8 floating numbers</input>
	<div>
		GPS Positions are updated every second. Update rate of your device can be diffrent.
	</div>

	<script>
		setInterval(function ()
		{
			getLocation();
		}, 1000);


		function getLocation() 
		{
			if (navigator.geolocation) 
			{
				navigator.geolocation.getCurrentPosition(showPosition, showError);
			}
			else 
			{
				var errorLabel = document.getElementById("error");
				errorLabel.innerHTML = "Geolocation is not supported by this browser.";
			}
		}

		function showPosition(position) 
		{
			try
			{
				var checkboxSelected = document.getElementById("fullFloat");
				var floatNumber = 2;
				if (true == checkboxSelected.checked)
				{
					floatNumber = 8;
				}


				// ------------------ NORTH -------------------------
				// Label
				var northInputLabel = document.getElementById("north");
				var northLiveLabel = document.getElementById("northIst");
				var northDiffLabel = document.getElementById("northDiff");

				// Calculation
				var northInput = parseFloat(new URL(location.href).searchParams.get('north'));
				var northLive = position.coords.latitude;
				var northDiff = northInput - northLive;
				var northDiffMeter = northDiff * 111568;

				// Insert values
				northInputLabel.innerHTML = northInput.toFixed(floatNumber) + "°";
				northLiveLabel.innerHTML = northLive.toFixed(floatNumber) + "°";
				northDiffLabel.innerHTML = northDiff.toFixed(floatNumber) + "°<br/>(" + northDiffMeter.toFixed(2) + " m)";

				// ------------------ EAST -------------------------
				// Label
				var eastInputLabel = document.getElementById("east");
				var eastLiveLabel = document.getElementById("eastIst");
				var eastDiffLabel = document.getElementById("eastDiff");

				// Calculation
				var eastInput = parseFloat(new URL(location.href).searchParams.get('east'));
				var eastLive = position.coords.longitude;
				var eastDiff = eastInput - eastLive;
				var eastDiffMeter = eastDiff * 74535;

				// Insert values
				eastInputLabel.innerHTML = eastInput.toFixed(floatNumber) + "°";
				eastLiveLabel.innerHTML = eastLive.toFixed(floatNumber) + "°";
				eastDiffLabel.innerHTML = eastDiff.toFixed(floatNumber) + "°<br/>(" + eastDiffMeter.toFixed(2) + " m)";


				// ------------------ HEIGHT -------------------------
				// Label
				var heightInputLabel = document.getElementById("height");
				var heightLabel = document.getElementById("heightIst");
				var heightDiffLabel = document.getElementById("heightDiff");

				// Calculation
				var heightInput = parseFloat(new URL(location.href).searchParams.get('height'));
				var heightLive = position.coords.altitude;

				if (heightLive == null)
				{
					// Insert values
					heightLabel.innerHTML = "-";
					heightDiffLabel.innerHTML = "-";
				}
				else
				{
					var heightDiff = heightInput - heightLive;
					var heightDiffMeter = heightDiff * 1;

					// Insert values
					heightLabel.innerHTML = heightLive.toFixed(2) + " m";
					heightDiffLabel.innerHTML = heightDiff.toFixed(2) + " m";
				}

				heightInputLabel.innerHTML = heightInput.toFixed(2) + " m";


				// ------------------ SPECIAL CALC -------------------------
				// Label
				var accuracyLabel = document.getElementById("accuracy");
				var accuracyHeightLabel = document.getElementById("accuracyHeight");

				var angleLabel = document.getElementById("angle");
				var distanceLabel = document.getElementById("distance");

				// Calculation
				var accuracy = position.coords.accuracy;
				var accuracyHeight = position.coords.altitudeAccuracy;
				var angle = Math.atan2(eastDiff, northDiff + 0.00001) * 180 / Math.PI;
				var distance = Math.sqrt(northDiffMeter * northDiffMeter + eastDiffMeter * eastDiffMeter);

				// Insert values
				accuracyLabel.innerHTML = accuracy.toFixed(2) + " m";
				if (accuracyHeight == null)
				{
					accuracyHeightLabel.innerHTML = "-";
				}
				else
				{
					accuracyHeightLabel.innerHTML = accuracyHeight.toFixed(2) + " m";
				}
				angleLabel.innerHTML = angle.toFixed(floatNumber) + "&deg;";
				distanceLabel.innerHTML = distance.toFixed(2) + " m";

			} catch (error)
			{
				alert(error)
			}

		}

		function showError(error) 
		{
			var errorLabel = document.getElementById("error");
			switch (error.code) 
			{
				case error.PERMISSION_DENIED:
					errorLabel.innerHTML = "User denied the request for Geolocation."
					break;
				case error.POSITION_UNAVAILABLE:
					errorLabel.innerHTML = "Location information is unavailable."
					break;
				case error.TIMEOUT:
					errorLabel.innerHTML = "The request to get user location timed out."
					break;
				case error.UNKNOWN_ERROR:
					errorLabel.innerHTML = "An unknown error occurred."
					break;
			}
		}
	</script>

</body>

</html>
